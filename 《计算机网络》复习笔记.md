# 《计算机网络》复习笔记

*这个笔记同时使用了两本教材：《计算机网络：自顶向下方法（原书第六版）》和《计算机网络（谢希仁 第七版）》， 目录结构按照自顶向下排列。*

> 日常牢记[Markdown语法](http://wowubuntu.com/markdown/)



## 一、前言：计算机和因特网

### 互联网概述

1. **Internet**两种译名：
   1. **因特网** （小写字母i开头）是一个通用名词，泛指由多个计算机网络互联而成的计算机网络。
   2. **互联网** （大写字母I开头）是一个专用名词，是指当前全球最大的、开放的、由众多网络相互连接而成的特定互联网，采用TCP/IP协议族作为通信规则。 
2. 定义：计算机网络（简称为网络）有若干结点（node）和连接这些结点的链路（link）组成。结点包括计算机、集线器、交换机、路由器等。
3. 互联网是“网络的网络”。网络把许多计算机连接在一起，而互联网则把许多网络通过路由器连接在一起。与网络向量的计算机常称为主机。
4. 区别：计算机网络把许多计算机连接在一起，而互联网则把许多网络连接在一起，是网络的网络。
5. 互联网基础结构发展的三个阶段：
   1. 从ARPANET的产生到互联网络的出现
   2. 建成了三级结构的互联网（主干网、地区网和校园网/企业网）
   3. 建成了多层次ISP结构的互联网。ISP（Internet Service Provider）互联网服务提供商。ISP又分为主干ISP、地区ISP和本地ISP。但他们之间不是严格的树形结构，存在**互联网交换点IXP** （Internet eXchange Point）横向连接
6. 制定互联网标准的三个阶段：
   1. 互联网草案：有效期只有6个月
   2. 建议标准：成为RFC（Request For Comments， 请求评论）文档



### 互联网的组成

1. 边缘部分
   1. 组成：所有连接在互联网上的主机
   2. 通信的主体：主机A的某个进程和主机B的某个进程
   3. 几种通信方式：
      1. C/S方式
      2. P2P方式
2. 核心部分
   1. 组成：网络和连接这些网络的**路由器**。路由器是实现分组交换的关键构建，其任务是转发收到的分组。
   2. 电路交换：通信双方之间分配一条专用的物理通路。
   3. 分组交换：采用**存储转发**技术。把整块数据划分为报文，一步步转发，高效灵活迅速可靠。
3. 计算机在我国的发展：
   1. 中国互联网络信息中心：CNNIC



### 计算机网络的类别

1. 广域网WAN（Wide Area Network）
2. 城域网MAN（Metropolitan Area Network）
3. 局域网LAN（Local Area Network）
4. 个人区域网PAN（Personal Area Network）



### 计算机网络的性能

1. 速率：单位为bit/s， 前缀为K M G T……
2. 带宽：表示某信道允许通过的信号频带范围称为带宽，单位为Hz。在计算机网络中可理解为“最高数据率”
3. 时延
   1. 发送时延 = 数据帧长度(bit) / 发送速率(bit/s)， 含义为从发送数据帧的第一个bit到最后一个bit发送完成所需时间。
   2. 传播时延 = 信道长度(m) / 电磁波在信道上的传播速率(m/s)， 含义为电磁波在信道中传播一定距离所花费的时间，比光速略低。受传输介质物理性质制约，一般无法提高。
   3. 处理时延：主机或路由器收到分组后处理的时间（例如进行差错检验等）
   4. 排队时延：分组在路由器输出队列中排队的时间。
   5. **总时延等于上述四种时延之和**
4. 时延带宽积：时延与带宽的乘积，意义是当第一个bit到达目的地时链路上尚存在多少bit正在传输途中。
5. 往返时间RTT
6. 利用率：



### 计算机网络体系结构

1. 分层的好处：
   1. 各层之间相互独立
   2. 灵活性好
   3. 结构上可分隔开
   4. 易于实现和维护
   5. 能促进标准化工作（主要功能包括以下：）
      1. 差错控制
      2. 流量控制
      3. 分段和重装
      4. 复用和分用
      5. 连接建立和释放
2. 各种体系结构的分层对比
   |      | OSI的体系结构 | TCP/IP的体系结构  | 五层协议的体系结构 |
   | :--: | :------: | :----------: | :-------: |
   |  7   |   应用层    |     应用层      |    应用层    |
   |  6   |   表示层    |      ↑       |     ↑     |
   |  5   |   会话层    |      ↑       |     ↑     |
   |  4   |   运输层    | 运输层（TCP或UDP） |    运输层    |
   |  3   |   网络层    |    网际层IP     |    网络层    |
   |  2   |  数据链路层   |    网络接口层     |   数据链路层   |
   |  1   |   物理层    |      ↑       |    物理层    |


3. OSI参考模型：（OSI/RM, Open Systems Interconnection Reference Model）
   1. OSI并不是事实标准。
   2. OSI是七层协议体系结构。
4. 具有五层协议的体系结构内容：（五层协议是折中OSI和TCP/IP的体系结构）
   1. 应用层（application layer）：任务是通过应用进程间的交互来完成特定网络应用。eg. DNS、HTTP、SMTP
   2. 运输层（transport layer）：任务是负责向两台主机中进程之间的通信提供通用的数据传输服务。主要使用：
      1. TCP（Transmission Control Protocol）传输控制协议：提供面向连接的、可靠的数据传输服务，数据传输单位为**报文段**（segment） 
      2. UDP（User Datagram Protocol）用户数据报协议：提供无连接的、尽最大努力的数据传输服务（不保证数据传输的可靠性），数据传输单位为**用户数据报** 
   3. 网络层（network layer）：负责为分组交换网上的不同主机提供通信服务。使用IP（Internet Protocol）协议，分组也叫**IP数据报** 。
   4. 数据链路层（data link layer）：在两个相邻结点间的链路上传送**帧**（frame）。
   5. 物理层（physical layer）：在物理层上所传数据的单位是bit
5. TCP/IP并不一定是单指TCP和IP两个协议，而往往是表示互联网所使用的TCP/IP协议族。
6. **协议**是控制两个对等实体（或多个实体）进行通信的规则的集合。协议是“**水平的**”，即协议是控制对等实体之间通信的规则。服务是“**垂直的**”，即服务是由下层向上层通过层间接口提供的。上层使用下层所提供的服务必须通过与下层交换一些命令，这些命令在OSI中称为**服务原语**。




## 二、应用层

### 域名系统DNS（Domain Name System）

1. 功能：将互联网上的主机名字转换为IP地址（因为IP地址不好记）
2. 域名中的标号由英文字母和数字组成，每一个标号不超过63个字符，不区分大小写字母，不能使用除连字符“-”外的标点符号。完整的域名不超过255字符。
3. DNS服务器的四种不同类型：
   1. 根域名服务器：知道所有顶级域名服务器的IP地址
   2. 顶级域名服务器：知道注册的所有二级域名的权限域名服务器（例如abc.com和y.abc.com各有一个权限域名服务器）
   3. 本地域名服务器：离用户最近的域名服务器，用户首先会请求本地域名服务器
4. DNS的解析过程：
   1. 递归查询：
   2. 迭代查询：





### 文件传送协议FTP（File Transfer Protocol）

1. FTP工作方式：服务器进程打开21端口接受数据连接，打开20端口接受控制连接
2. FTP与NFS（网络文件系统）的主要区别：FTP无法远程修改文件（只能下载到本地-修改-上传）而NFS可以
3. **简单文件传送协议TFTP（Trivial File Transfer Protocol）** 





### 远程终端协议TELNET

1. TELNET是一个简单的远程终端协议，又称为终端仿真协议。定义了NVT（Network Virtual Terminal， 网络虚拟终端）格式，使用7位ASCII码传送数据，高位置1时用作控制指令。





### 万维网WWW

1. 万维网（World Wide Web）是一个大规模的、联机式的信息储藏所，英文简称为Web。万维网用链接的方法从互联网上的一个站点访问另一个站点。
2. 万维网是一个超媒体（hypermedia）系统，他是超文本（hypertext）系统的扩充。
3. 万维网使用**统一资源定位符URL（Uniform Resource Locator）**来标志万维网上的各种文档。
   1. URL格式：<协议>://<主机>:<端口>/<路径>
   2. 常用协议为HTTP和FTP
   3. 端口号默认为80（可不写）





### 超文本传送协议HTTP 

1. 超文本传送协议HTTP（HyperText Transfer Protocol）是一个应用层协议，使用TCP连接进行可靠的传送。
   1. HTTP是面向事务的应用层协议，使用80端口接受连接。
   2. HTTP是无连接、无状态的，客户端和服务器之间交换HTTP报文前不需要握手，服务器也并不记得客户端是否曾经访问过。
   3. HTTP的历史版本：
      1. HTTP/1.0：不支持持续连接，每个连接仅传送一个文件
      2. HTTP/1.1：加入了持续连接，支持流水线方式和非流水线方式（所谓流水线，是指客户不用等待前一个响应的到来就可以发出下一个请求，而非流水线则需要每次收到响应之后才能发出下一个请求）
   4. 代理服务器（proxy server）：

2. HTTP报文结构：

   1. 开始行：用于区分是请求报文还是响应报文。在请求报文中叫做请求行，在响应报文中叫做状态行。开始行三个字段之间用空格分开，结尾为CR（回车）和LF（换行）
      1. 请求行：包括方法、URL、版本
      2. 响应行：包括版本、状态码、短语
   2. 首部行：用来说明浏览器、服务器或报文主体的一些信息，可以不止一行。
   3. 实体主体（entity body，也叫实体体）：请求报文一般不用，响应报文中很可能没有这个字段

3. HTTP方法：
   1. OPTION：请求一些选项的信息
   2. GET：请求读取由URL所标志的信息
   3. HEAD：请求读取由URL所标志的信息的首部
   4. POST：给服务器添加信息
   5. PUT：在指明的URL下存储一个文档
   6. DELETE：删除指明的URL所标志的资源
   7. TRACE：用来进行环回测试的请求报文
   8. CONNECT：用于代理服务器

4. HTTP响应报文的状态码：三位数字

   1. 1xx表示通知信息，如请求收到了或正在进行处理

   2. 2xx表示成功，如接受或知道了。常见：202 Accepted

   3. 3xx表示重定向，如要完成请求还必须采取进一步的行动

   4. 4xx表示客户的差错，如请求中的错误的语法或不能完成。

      常见：400 Bad Request； 404 Not Found

   5. 5xx表示服务器的差错，如服务器失效无法完成请求

5. 例：HTTP请求报文

   GET /dir/index/htm HTTP/1.1		开始行：方法为GET，使用相对URL，HTTP版本为1.1

   Host: www.xyz.edu.cn				首部行：给出了主机域名

   Connection: close				首部行：告诉服务器发送完请求的文档之后就可以释放链接

   User-Agent: Mozilla/5.0			首部行：表示用户代理是使用火狐浏览器Firefox

   Accept-Language: cn				首部行：表示用户希望优先得到中文版本的文档

   ​								空行：请求报文的最后还有一个空行

6. 在服务器上存放用户的信息：服务器在响应报文中给客户端分配一个Cookie作为其识别码

7. 超文本标记语言HTML（HyperText Markup Language）




### 电子邮件

- 电子邮件系统的组成：

1. 用户代理UA（User Agent）：用户与电子邮件系统的接口，又称为电子邮件客户端软件。具备以下四个功能：
   1. 撰写
   2. 显示
   3. 处理（包括发送邮件和接收邮件）
   4. 通信（将邮件发给邮件服务器或是从邮件服务器取回邮件）
2. 邮件服务器
   1. 邮件从发件人的邮件服务器到收件人的邮件服务器是直达的（两台服务器之间直接通过TCP连接），不经过任何中转。
3. 邮件发送协议和邮件读取协议

#### 简单邮件传送协议SMTP（Simple Mail Transfer Protocol） 

1. 是一个邮件发送协议，仅支持传送可打印的7位ASCII码邮件。SMTP把邮件“**推**”给服务器。
2. SMTP使用端口号为25
3. 使用场景：用户代理将邮件发送给邮件服务器，邮件服务器将邮件发送给目标用户的邮件服务器。
4. 缺点：
   1. 发件人的地址不需要经过鉴别
   2. 设计为只传输ASCII码而不是二进制数据（如需传输二进制数据则要编码为7字节的ASCII码）
   3. 传送邮件为明文
   4. SMTP服务器会拒绝超过一定长度的邮件
   5. 产生扩充的SMTP：“**ESMTP**“ 

#### 通用互联网邮件扩充MIME（Multipurpose Internet Mail Extensions）

1. 在现有的电子邮件程序和协议下传送，但增加了邮件主体的结构，并定义了传送非ASCII码的编码规则。（个人理解相当于在SMTP上加了一个表示层）
2. 在邮件首部说明邮件的数据类型，可以发送文本、声音、图像、视频等数据。
3. 对于任意的二进制文件，使用base64编码

#### 邮局协议POP3（Post Office Protocol）第三版 

1. 是一个邮件读取协议，仅支持将邮件从服务器“**拉**”回来 （拉完服务器就删除邮件了）
2. 使用场景：用户代理从邮件服务器那里取回自己的邮件。

#### 网际报文存取协议IMAP（Internet Message Access Protocol）第四版 

1. 是一个联机协议，客户端通过IMAP可以操纵邮件服务器的邮箱，最大特点是支持多客户端访问邮箱。



### 动态主机配置协议DHCP（Dynamic Host Configuration Protocol）

1. 服务器端使用UDP 67端口，客户端使用UDP 68端口。

2. 提供的机制：即插即用连网（Plug-and-Play networking）

3. 配置的内容：IP地址、子网掩码、默认路由器的IP地址、域名服务器的IP地址

4. 使用方法：

   0. DHCP服务器被动打开UDP端口67，等待客户端发来报文


      1. 客户端主机接入网络，向DHCP发送一个**发现报文**（0.0.0.0:68 to 255.255.255.255:67）
      2. DHCP服务器接到报文，发出一个回答报文叫做“**提供报文**”（server IP:67 to 255.255.255.255:68）,提供具有一定租用期T的IP地址（在网络内DHCP服务器可能不止一个）
      3. 客户端挑选一个DHCP提供者，向其发送DHCP**请求报文**（0.0.0.0:68 to server IP:67），请求其作为提供者
      4. 该DHCP服务器回复**确认报文**（server IP:67 to 255.255.255.255:68），告知客户端可以使用其分配的IP地址，这种状态叫做已绑定状态。 
      5. 之后客户端就可以使用该IP地址了。客户端维护两个计时器T1和T2（T1 = 0.5T， T2 = 0.875T），计时器到之后DHCP客户端请求DHCP服务器要求更新租用期。
      6. 若DHCP服务器同意更新，则返回新的确认报文，客户端更新计时器；若DHCP不同意，则返回**否认报文**，这时DHCP客户端必须立即停用原来的IP地址，返回步骤1重新申请。
      7. DHCP客户可以随时终止租用，只需向DHCP服务器发送**释放报文**。 

### 简单网络管理协议SNMP 

==这一部分貌似没有学过，在谢希仁书297页==



## 三、运输层

运输层概述：

1. 运输层为相互通信的应用进程提供逻辑通信
2. 运输层提供复用和分用（IP也提供）
3. 运输层提供差错检测（UDP仅提供检验和）
4. 运输层的两个协议：
   1. 传输控制协议TCP（Transmission Control Protocol），提供面向连接的、全双工的可靠信道。传输数据的单位为报文段（segment）
   2. 用户数据报协议UDP（User Datagram Protocol），提供无连接的、不可靠的信道。传输数据的单位为数据报（datagram）
   3. *流控制传输协议SCTP（Stream Control Transmission Protocol）不常用
5. UDP承载的常见应用层协议：[熟知端口号列表（维基百科）](https://zh.wikipedia.org/wiki/TCP/UDP%E7%AB%AF%E5%8F%A3%E5%88%97%E8%A1%A8)
   1. 名字转换：DNS（域名系统）端口53（DNS也可能使用TCP）
   2. 文件传送：TFTP（简单文件传送协议）端口69
   3. 路由选择协议：RIP（路由信息协议）端口520
   4. IP地址配置：DHCP（动态主机配置协议）服务器：67，客户端：68，DHCPv6客户端：546，DHCPv6服务器：547
   5. 网络管理：SNMP（简单网络管理协议）端口161
   6. 远程文件服务器：NFS（网络文件系统）
   7. 多播：IGMP（网际组管理协议）
6. TCP承载的常见应用层协议：
   1. 电子邮件：
      1. STMP（简单邮件传送协议）端口25
      2. IMAP4（网际报文存取协议第四版）端口143
      3. POP3（邮局协议第三版）端口110
   2. 远程终端接入：TELNET（远程终端协议）端口23
   3. 万维网：HTTP（超文本传送协议）端口80
   4. 文件传送：FTP（文件传送协议）数据：20，控制：21
   5. 远程登录：SSH（Secure Shell）端口：22




### 用户数据报协议UDP

1. UDP的特点
   1. 仅在IP的数据报服务之上增加了复用和分用的功能以及差错检测的功能（详见UDP报文头部）
   2. 无连接的：发送数据之前不需要建立连接，发送之后也不需要释放
   3. 使用尽最大努力交付：即不保证可靠交付，主机不需要维持复杂的连接状态
   4. 面向报文的：UDP对应用层传来的报文，既不合并，也不拆分，一次交付一个完整报文（若过长，则由IP层对其进行分片）
   5. 没有拥塞控制：一方面会导致不可预测的丢包，另一方面也可以用于绕过TCP的拥塞控制机制而确保低时延
   6. 即可以点对点传送，也可以广播（目的IP地址为255.255.255.255）或多播（目的IP地址为D类组播地址，利用IGMP协议）
2. UDP的首部格式：总长8字节
   1. 源端口（2字节）：在需要对方回信时选用，不需要时可用全0
   2. 目的端口（2字节）：接收方如果发现端口号不正确，则返回一个ICMP不可达报文给发送方
   3. 长度（2字节）：最小为8（仅有头部），最大寻址为64KB，也是UDP报文最大长度（65536 - 8 = 65528 Bytes）
   4. 检验和（2字节）：计算时会在报文前加一个**伪首部**，内容包括：源IP地址（4字节）、目的IP地址（4字节）、0（1字节，不知道是什么含义）、17（1字节，17是IP首部中协议字段的值）、UDP长度（2字节，内容与真首部的长度相同）



### 可靠传输的工作原理





### 传输控制协议TCP

1. TCP的特点
   1. 面向连接的协议：使用之前先建立连接，传输完成之后必须释放连接
   2. 点对点的：
   3. 提供全双工通信：
   4. 面向字节流：TCP将上层交付的数据仅仅看成是一连串的无结构的字节流
2. 每条TCP连接唯一地被通信两端的两个端点（即两个套接字）所确定。










## 四、网络层



## 五、链路层



## 六、物理层



## 七、无线网络和移动网络



## 八、多媒体网络



## 九、网络安全







# 附：《计算机网络（第七版）》（谢希仁著）的课后作业

1-01 计算机网络可以向用户提供端对端的传输服务，可以是面向连接的、可靠的服务（TCP），也可以是无连接的、不可靠的尽力而为的服务（UDP）。

1-02 分组交换的要点：==暂时不会== 

1-03 各自的优缺点：==未填完== 

|      |    优点     |           缺点            |
| :--: | :-------: | :---------------------: |
| 电路交换 | 速度快，传输无延迟 | 效率低，建立交换需要时间，使用完毕需要拆除连接 |
| 报文交换 |           |                         |
| 分组交换 |           |                         |

